---
title: "Devoir - Logiciel R4"
output: 
  html_document:
    theme: "cerulean"
    toc: yes
    toc_float: yes
author: "YILMAZ Ilayda et QUARTIER Laurine"
date: 28/03/2024
editor_options:
  chunk_output_type: console
---
  
## Partie A 

### Question 1 
  
```{r, echo = FALSE, include = FALSE}
library(data.table)
require(data.table)
require(stargazer)
require(foreign)
library(knitr)

# Chargement des données : 
data <- read.dta("Data/crime1_simplified.dta")
```

```{r}
# Vérification des variables :
colnames(data)
```

Les variables sont bien toutes présentes dans la base de données.


```{r}
# Format des données :
str(data)
```

Les variables "narr86" et "ptime86" ont un format integer ce qui est cohérent avec leur description. Les autres variables sont numériques.

```{r}
data$inc86carre = round(data$inc86^2, 5)
attach(data)
```

### Question 2 

```{r}
nrow(data)
```

Il y a 2 725 observations dans la base de données.


```{r}
ncol(data)
```

Il y a 7 variables dans la base de données. Ces variables sont toutes qualitatives.

### Question 3

```{r}
na <- data[rowSums(is.na(data)) > 0, ]
sum(na)
```

Il n'y a pas d'observations manquantes dans la base de données.

### Question 4 

```{r}
summary(data)

f <- function(data) round(c(Min = min(data),
                            Max = max(data),
                            Mean = mean(data),
                            Median = median(data),
                            Sd = sd(data)), 3)

descrstat <- setDT(data)[, sapply(.SD, f)]
kable(descrstat, 
             "simple",
             caption = "Sommaires des variables quantitatives")
```

```{r}
sum(data$narr86 == 12)
sum(data$ptime86 == 12)
```


D'après ce tableau, en moyenne un homme a été arrêté 0,40 fois par la police en 1986. Mais sur les 2 725 individus, l'homme qui a été arrêté le plus grand nombre de fois a été arrêté 12 fois. 

De plus la proportion moyenne des arrestations avant 1986 ayant mené à une condamnation est de 0,36.
En moyenne en 1986, les hommes ont passé 0,39 mois soit environ 1,5 semaines en prison. Cependant, le temps maximal passé en prison est de 12 mois pour 58 individus.

En moyenne, les individus ont travaillé 2,31 trimestres en 1986, soit environ 7 mois. A la vue des données, on en déduit que le revenu disponible des individus est exprimé en revenu par mois. En 1986, le revenu disponible moyen des hommes nés en Californie est d'environ 550 dollars par mois.

## Partie B 

### Question 1 

\begin{equation}
narr86_i = \beta_0 + \beta_1 pcnv_i + \beta_2 avgsen_i + \beta_3 ptime86_i + \beta_4 qemp86_i + \beta_5 inc86_i + u_i 
\end{equation}

Pour β1, on s'attend à ce que le signe du coefficient soit positif car plus la proportion des arrestations avant 1986 ayant mené à une condamnation augmente, plus le nombre de fois où l'homme a été arrêté par la police augmente.

Pour le signe de β2 on s'attend à un coefficient négatif, car un homme qui a eu une peine de prison plus longue se fera moins arrêté qu'un homme qui aura eu une peine de prison plus courte. Dans la même idée, on s'attend à un signe négatif pour β3.

On peut penser que plus le nombre de trimestres travaillés en 1986 par un individu augmente, plus le nombre de fois où l'homme a été arrêté par la police 1986 diminue, donc on s'attend à un coefficient négatif pour β4. De même, plus le revenu disponible de l'homme augmente, moins le nombre d'arrestations augmente, donc on s'attend également à un coefficient négatif pour β5.

### Question 2 

```{r}
reg1 <- lm(narr86~pcnv + avgsen + ptime86 + qemp86 + inc86, data = data)
summary(reg1)
```

### Question 3

Pour déterminer la significativité des coefficients, on compare la p-value (qui se trouve dans la quatrième colonne du tableau des résultats de la régression) à 1% : si p-value < 1% alors le coefficient est significatif ; si p-value > 1% alors le coefficient n'est pas singificatif. 
Ici les coefficients des variables "pcnv", "ptime86", "qemp86" et "inc86" sont significatifs au seuil de 1%. 

La variable "pcnv" étant une proportion, on exprime ses variations en pourcentage. En moyenne, quand la proportion des arrestations avant 1986 qui ont mené à une condamnation augmente de 1 point de pourcentage, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,15, toutes choses égales par ailleurs.

En moyenne, quand le nombre de mois passés en prison en 1986 augmente d'une unité, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,04, à autres variables fixées.
En moyenne, quand le nombre de trimestres où la personne a travaillé augmente d'une unité, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,05, toutes choses égales par ailleurs.

En moyenne, quand le revenu disponible de la personne en 1986 augmente de 100$, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,002, toutes choses égales par ailleurs.

Malgré le fait que le coefficient de "avgsen" ne soit pas significatif, en moyenne lorsque la durée moyenne de la peine pour les condamnations avant 1986 augmente d'une unité, le nombre de fois ou l'homme a été arrété par la police en 1986 augmente d'environ 0.007, à autres facteurs fixés. 

### Question 4

\begin{equation}
narr86_i = \beta_0 + \beta_1 pcnv_i + \beta_2 avgsen_i + \beta_3 ptime86_i + \beta_4 qemp86_i + \beta_5 inc86_i + \beta_6 inc86carre_i + u_i 
\end{equation}

```{r}
reg2 <- lm(narr86~pcnv + avgsen + ptime86 + qemp86 + inc86 + inc86carre, data = data)
summary(reg2)
```

On observe que le coefficient β6 de la variable "inc86carre" est significatif au seuil de 1% car sa p-value (0,0011) est inférieure à 1%.

De plus, le R carré ajusté a augmenté par rapport à la précédente régression. Donc l'ajout du revenu au carré dans la régression était pertinent.

En moyenne, quand le revenu de l'individu augmente de 100$, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,004, à autres variables fixées.

### Question 5 

Les coefficients qui sont significatifs sur "narr86", sont les variables "pcnv", "ptime86", "inc86" et "inc86carre".

En moyenne, quand la proportion des arrestations avant 1986 qui ont mené à une condamnation augmente de 1%, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,16, toutes choses égales par ailleurs.

En moyenne, quand le nombre de mois passés en prison en 1986 augmente d'une unité, le nombre de fois où l'homme a été arrêté par la police en 1986 diminue d'environ 0,03, à autres variables fixées.
L'effet d'une augmentation du revenu sur le nombre d'arrestations de l'individu dépend de la valeur initiale du revenu : β4 + 2β6inc86.

Malgré le fait que le coefficient de "avgsen" ne soit pas significatif, en moyenne lorsque la durée moyenne de la peine pour les condamnations avant 1986 augmente d'une unité, le nombre de fois ou l'homme a été arrété par la police en 1986 augmente d'environ 0.006, à autres facteurs fixés. 

Malgré le fait que le coefficient de "qemp86" ne soit pas significatif, en moyenne lorsque le nombre de trimestre ou la personne a travaillé en 1986 augmente d'un trimiestre, le nombre de fois ou l'homme a été arrété par la police en 1986 diminue d'environ 0.02, à autres facteurs fixés. 

### Question 6 

Pour déterminer si il y a un problème d'hétéroscédasticité, on va réaliser un test de Breusch Pagan. 

```{r}
require(lmtest)
bptest(reg2)
```

On constate que la p-value du test est inférieure à 1% (4,53e-07) donc on rejette l'hypothèse d'homoscédasticité donc il y a hétéroscédasticité.


### Question 7

```{r}
library("sandwich")
coeftest(reg2, 
         vcov = vcovHC(reg2, type = "HC0"))
summary(reg2)
```

Il n'y a pas de changements majeurs après avoir corrigés les erreurs-types : les coefficients sont quasiment identiques, leur significativité ne change pas et le R carré ajusté ne change pas. Seules les erreurs standards des coefficients significatifs diminuent

## Partie C

### Question 1 

```{r}
data$condamne <- ifelse(data$pcnv > 0, 1, 0)
```

### Question 2 

\begin{equation}
narr86_i = \beta_0 + \beta_1 condamne_i + \beta_2 avgsen_i + \beta_3 ptime86_i + \beta_4 qemp86_i + \beta_5 inc86_i + \beta_6 inc86carre_i + u_i 
\end{equation}

```{r}
reg3 <- lm(narr86~condamne + avgsen + ptime86 + qemp86 + inc86 + inc86carre, data = data)
summary(reg3)
```

### Question 3

E(narr86 | condamne = 1) - E(narr86 | condamne = 0) = β1 = -0.004

En moyenne, le nombre d'arrestations moyen en 1986 pour les personnes déjà condamnées est 0,004 fois plus faible que pour les personnes qui n'ont pas été condamnées. Cependant le coefficient de la variable "condamne" n'est pas significatif à 10% donc cette variable n'a pas de réel impact sur le nombre d'arrestation. 

### Question 4 

Pour savoir si l'effet du nombre de trimestres où la personne a été employée sur le nombre d'arrestations en 1986 est différent selon que la personne a déjà été condamné ou pas, nous allons ajouter une interaction entre les variables "qemp86" et "condamne".

\begin{equation}
narr86_i = \beta_0 + \beta_1 condamne_i + \beta_2 avgsen_i + \beta_3 ptime86_i + \beta_4 qemp86_i + \beta_5 inc86_i + \beta_6 inc86carre_i + \beta_7 condamne_i * qemp86_i + u_i 
\end{equation}


### Question 5

```{r}
reg4 <- lm(narr86~condamne + avgsen + ptime86 + qemp86 + inc86 + inc86carre + I(condamne*qemp86), data = data)
summary(reg4)
```


### Question 6 

Pour obtenir l'effet moyen sur le nombre d'arrestations en 1986 d'une augmentation du nombre de trimestres travaillés pour une personne déjà condamnée, on effectue la dérivée partielle du nombre d'arrestations sachat que la personne a déjà été condamnée par rapport au nombre de trimestres travaillés : (dnarr86 | condamn = 1) / dqemp86 = β4 + β7 = 0,003 - 0,009 = - 0,006. 

Ainsi, en moyenne pour une personne ayant déjà été condamnée, quand le nombre de trimestres où la personne a travaillé augmente d'un trimestre, le nombre d'arrestations diminue d'environ 0,006, toutes choses égales par ailleurs.

Pour obtenir l'effet moyen sur le nombre d'arrestations en 1986 d'une augmentation du nombre de trimestres travaillés pour une personne n'ayant jamais été condamnée, on effectue la dérivée partielle du nombre d'arrestations sachant que la personne n'a jamais été condamnée par rapport au nombre de trimestres travaillés : (dnarr86 | condamn = 0) / dqemp86 = β4 = 0,003. 

Ainsi, en moyenne pour une personne n'ayant jamais été condamnée, quand le nombre de trimestres où la personne a travaillé augmente d'un trimestre, le nombre d'arrestations augmente d'environ 0,003, toutes choses égales par ailleurs.

La différence entre les deux effets n'est pas énorme, mais on passe tout de même d'un effet négatif pour les personnes ayant déjà été condamnées, a un effet positif pour les personnes n'ayant jamais été condamnées. 



## Partie D 

Dans toutes les régressions, les coefficients avaient des valeurs très faibles, donc malgré le fait que les coefficients soient significatifs, les effets restent très faibles. 

De plus, en observant la base de données, on remarque quelques observations incohérentes : par exemple une personne qui n'a pas été en prison et qui a un revenu nul. Il serait peut être pertinent d'ajouter une variable qui comptabilise les personnes dans ce cas c'est-à-dire celles qui n'ont jamais été en prison, mais qui ne travaillent pas non plus. 

On peut aussi penser que la variable "inc86" souffre d'endogénéité. En effet elle peut être liée à la variable omise éducation.
La corrélation entre éducation et inc86 est positive car plus une personne fait d'études, plus son revenu augmente en moyenne. De plus, éducation est corrélée négativement au nombre d'arrestations car on peut penser que quelqu'un qui a fait beaucoup d'études se fera moins arrêté. 
Ainsi on peut penser que le coefficient associé à inc86 capte l'effet de l'éducation de l'individu donc est biaisé positivement. 

Le fait d'avoir ajouté l'interaction "condamne * qemp86" a permis d'avoir un modèle plus précis car le R carré ajusté a augmenté.



